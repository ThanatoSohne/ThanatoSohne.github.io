<!DOCTYPE html>

<html>
<head>
</head>
<body>
<h2>ActiveIcmJS Demo Page</h2>
<br>
<!--
<button onclick="mainJS()">Load</button>
-->

<div id="con" style="width: 800px; height: 600px; border: 2px solid #ABABAB; resize: both; overflow: auto;">
<img src="ajax-loader.gif" id="wheel" style="display: block; margin: auto; position: relative; top: 50%; left: 0; right: 0 ">
</div>

<script src="libicm.js"> </script>
<!--
<script src="libicm_int.js"> </script>
-->
<script>
function testWebGL()
{
  var cvs = document.createElement('canvas');
  try{
    var ctx = cvs.getContext('webgl');
    if (ctx != null)
      return true;
    ctx = cvs.getContext('experimental-webgl');
    return (ctx != null);
  } catch(e) {
    return false;
  }
}
//
function mainJS()
{
  console.log("main");

  if (!testWebGL()) {
    document.getElementById("con").innerHTML = "You browser does not support WebGL";
    return;
  }

  var js_int = document.createElement("script");
  js_int.type = "text/javascript";
  js_int.src = "libicm_int.js";
  js_int.onreadystatechange= js_int.onload = function () {

    makeShell = Module.cwrap('makeShell','number',[]);
    runScript = Module.cwrap('runScript','number',['string']);
    readBinary = Module.cwrap('readBinary','number',['string']);

    var canvas = document.createElement("canvas");
    canvas.width = 800;
    canvas.height = 600;
    document.getElementById("con").appendChild(canvas);

    //show Emscripten environment where the canvas is
    Module.canvas = canvas;
    new ActiveIcmJS.Program(Module.canvas);
    // 
    console.log("readBinary=",readBinary("NewProject.icb"));
    //
    document.getElementById("wheel").style.display="none";
  }
  var head = document.getElementsByTagName('head')[0];
  head.appendChild(js_int);
}
//
</script>


</body>
</html>